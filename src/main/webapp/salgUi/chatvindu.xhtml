<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template/tomTemplate.xhtml">

        <ui:define name="body">
            <h:body>
    <p:growl id="growl" showDetail="true" />  

    <h:form id="form">  


        <p:panel id="container" header="Hc chat" toggleable="true">  

            <h:panelGroup rendered="#{chat.loggedIn}">  

                <p:panelGrid columns="2" columnClasses="publicColumn,usersColumn" style="width:600px; height: 500px">  
                    <p:outputPanel id="public" layout="block" styleClass="ui-corner-all ui-widget-content chatlogs" style="width: 400px"/>  

                    <p:dataList id="users" var="user" value="#{chatList.users}" styleClass="usersList" style="width:200px; height: 490px">  
                        <f:facet name="header">  
                            Users  
                        </f:facet> 


                        <p:commandButton title="Chat" icon="ui-icon-comment" oncomplete="pChat.show()" update=":privateChatContainer">  
                            <f:setPropertyActionListener value="#{user}" target="#{chat.privateUser}" />  
                        </p:commandButton>  
                        #{user}
                    </p:dataList>  
                </p:panelGrid>  

                <p:separator />  

                <p:inputText value="#{chat.globalMessage}" styleClass="messageInput" />  
                <p:spacer width="5" />  
                <p:commandButton value="Send" actionListener="#{chat.sendGlobal}" oncomplete="$('.messageInput').val('').focus()"/>  
                <p:spacer width="5" />  
                <p:commandButton value="Disconnect" actionListener="#{chat.disconnect}" global="false" update="container" />  
            </h:panelGroup>  

            <h:panelGroup rendered="#{not chat.loggedIn}" > 

                <p:commandButton value="Login" actionListener="#{chat.login}" update="container"   
                                 icon="ui-icon-person" />  
            </h:panelGroup>  

        </p:panel>              

    </h:form> 
    </h:body>
    <p:dialog widgetVar="pChat" header="Private Chat" modal="false" >  
        <h:panelGrid id="privateChatContainer" columns="2" columnClasses="vtop,vtop">  
            <p:outputLabel for="pChatInput" value="To: #{chat.privateUser}" />  
            <p:inputTextarea id="pChatInput" value="#{chat.privateMessage}" rows="5" cols="30" />  

            <p:spacer />  
            <p:commandButton value="Send" actionListener="#{chat.sendPrivate}" oncomplete="pChat.hide()" />  
        </h:panelGrid>  
    </p:dialog>  
    <p:socket onMessage="handleMessage" channel="/HC" autoConnect="false" widgetVar="subscriber"/> <script type="text/javascript">  
        function handleMessage(data) {  
            var chatContent = $(PrimeFaces.escapeClientId('form:public'));  
            chatContent.append(data + '<br />');  
  
            //keep scroll  
            chatContent.scrollTop(chatContent.height());  
        }  
    </script>  
        </ui:define>
    </ui:composition>




</html>
